<p>To perform the below analysis I used NYC 311 complaints data from which I extracted years worth of homeless complaints. The 311 complaints data is made freely available here: <a href="https://nycopendata.socrata.com/Social-Services/311-Service-Requests-from-2010-to-Present/erm2-nwe9">NYC 311 data</a>. The whole dataset is pretty huge so extract the right columns before doing further analysis.</p>

<p>I was interested in knowing how homeless complaints vary with days, months, seasons etc. So firstly I grouped homeless complaints by months in year 2015:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="nb">require</span><span class="p">(</span><span class="n">leaflet</span><span class="p">)</span>
<span class="nb">require</span><span class="p">(</span><span class="n">plotly</span><span class="p">)</span>
<span class="nb">require</span><span class="p">(</span><span class="n">dplyr</span><span class="p">)</span>
<span class="nb">require</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">read</span><span class="p">.</span><span class="nf">csv</span><span class="p">(</span><span class="s2">"311_Service_Requests_from_2010_to_Present-3.csv"</span><span class="p">,</span> <span class="n">strip</span><span class="p">.</span><span class="nf">white</span><span class="o">=</span><span class="no">TRUE</span><span class="p">)</span>
<span class="c1">#df_manhattan = df[grep("manhattan", df$Borough, ignore.case = TRUE),]   # if you want to restrict analysis to manhattan</span>
<span class="n">dfh</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">grep</span><span class="p">(</span><span class="s2">"homeless"</span><span class="p">,</span> <span class="n">df</span><span class="vg">$Complaint</span><span class="o">.</span><span class="no">Type</span><span class="p">,</span> <span class="n">ignore</span><span class="p">.</span><span class="nf">case</span> <span class="o">=</span> <span class="no">TRUE</span><span class="p">),</span> <span class="p">]</span>

<span class="n">dfh</span><span class="vg">$year</span> <span class="o">=</span> <span class="n">as</span><span class="p">.</span><span class="nf">numeric</span><span class="p">(</span><span class="nb">format</span><span class="p">(</span><span class="n">as</span><span class="o">.</span><span class="no">Date</span><span class="p">(</span><span class="n">dfh</span><span class="vg">$Created</span><span class="o">.</span><span class="no">Date</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span> <span class="s2">"%m/%d/%Y"</span><span class="p">),</span> <span class="s2">"%Y"</span><span class="p">))</span>
<span class="n">dfh</span><span class="vg">$month</span> <span class="o">=</span> <span class="n">as</span><span class="p">.</span><span class="nf">numeric</span><span class="p">(</span><span class="nb">format</span><span class="p">(</span><span class="n">as</span><span class="o">.</span><span class="no">Date</span><span class="p">(</span><span class="n">dfh</span><span class="vg">$Created</span><span class="o">.</span><span class="no">Date</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span> <span class="s2">"%m/%d/%Y"</span><span class="p">),</span> <span class="s2">"%m"</span><span class="p">))</span>

<span class="n">dfh2015</span> <span class="o">=</span> <span class="n">dfh</span><span class="p">[</span><span class="n">dfh</span><span class="vg">$year</span><span class="o">==</span><span class="s2">"2015"</span><span class="p">,]</span>
<span class="n">monthwise</span> <span class="o">=</span> <span class="n">dfh2015</span> <span class="sx">%&gt;%
            group_by(month) %&gt;</span><span class="o">%</span>
            <span class="n">summarise</span><span class="p">(</span><span class="n">total</span><span class="o">=</span><span class="n">n</span><span class="p">())</span>

<span class="n">g3</span> <span class="o">=</span> <span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">monthwise</span><span class="p">)</span> <span class="o">+</span> <span class="n">geom_bar</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">reorder</span><span class="p">(</span><span class="n">month_name</span><span class="p">,</span> <span class="n">month</span><span class="p">),</span> <span class="n">y</span><span class="o">=</span><span class="n">total</span><span class="p">),</span> <span class="n">stat</span><span class="o">=</span><span class="s2">"identity"</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="s2">"blue"</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">0</span><span class="o">.</span><span class="mi">5</span><span class="p">)</span>
<span class="n">g3</span> <span class="o">=</span> <span class="n">g3</span> <span class="o">+</span> <span class="n">labs</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">"Monthwise Complaints for 2015"</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s2">"Month"</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">"Complaints"</span><span class="p">)</span>
<span class="n">g3</span></code></pre></figure>

<p><img src="/images/monthwise-2015.png" alt="homeless_complaints_monthwise_2015" /></p>

<p>Interesting what’s happening in December. So let’s drill down:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">g3</span> <span class="o">=</span> <span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">day_wise</span><span class="p">[</span><span class="mi">352</span><span class="p">:</span><span class="mi">365</span><span class="p">,</span> <span class="p">])</span> <span class="o">+</span> <span class="n">geom_bar</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">date</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">total</span><span class="p">),</span> <span class="n">stat</span><span class="o">=</span><span class="s2">"identity"</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="s2">"blue"</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">0</span><span class="o">.</span><span class="mi">5</span><span class="p">)</span>
<span class="n">g3</span> <span class="o">=</span> <span class="n">g3</span> <span class="o">+</span> <span class="n">labs</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">"December Homeless Complaints - 2015"</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s2">"Day"</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">"Complaints"</span><span class="p">)</span>
<span class="n">g3</span></code></pre></figure>

<p><img src="/images/december.png" alt="homeless_complaints_december" /></p>

<p>Uh oh! One might expect the number of complaints to rise around Christmas time but there’s actually a dip there. Maybe no one cares to complaint that day or not many are actually asking for alms.</p>

<p>And lets generally plot complaints grouped by days for the whole year of 2015:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">dfh2015</span><span class="vg">$date</span> <span class="o">=</span> <span class="n">as</span><span class="o">.</span><span class="no">Date</span><span class="p">(</span><span class="n">dfh2015</span><span class="vg">$Created</span><span class="o">.</span><span class="no">Date</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span> <span class="s2">"%m/%d/%Y"</span><span class="p">)</span>
<span class="n">day_wise</span> <span class="o">=</span> <span class="n">dfh2015</span> <span class="sx">%&gt;%
            group_by(date) %&gt;</span><span class="o">%</span>
            <span class="n">summarise</span><span class="p">(</span><span class="n">total</span><span class="o">=</span><span class="n">n</span><span class="p">())</span>

<span class="n">g3</span> <span class="o">=</span> <span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">day_wise</span><span class="p">)</span> <span class="o">+</span> <span class="n">geom_bar</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">date</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">total</span><span class="p">),</span> <span class="n">stat</span><span class="o">=</span><span class="s2">"identity"</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="s2">"blue"</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">0</span><span class="o">.</span><span class="mi">5</span><span class="p">)</span>
<span class="n">g3</span> <span class="o">=</span> <span class="n">g3</span> <span class="o">+</span> <span class="n">labs</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">"Daywise Complaints for 2015"</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s2">"Day"</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">"Complaints"</span><span class="p">)</span>
<span class="n">g3</span>

<span class="n">day_wise</span><span class="p">[</span><span class="n">which</span><span class="p">.</span><span class="nf">max</span><span class="p">(</span><span class="n">day_wise</span><span class="vg">$total</span><span class="p">),]</span></code></pre></figure>

<p><img src="/images/daywise.png" alt="homeless_complaints_daywise" /></p>

<p>Does the December 25 pattern repeat for other holidays? I superimposed the <a href="https://www.newyorkfed.org/aboutthefed/holiday_schedule.html">holidays</a> with <code class="highlighter-rouge">Red</code> dots on the above daywise graph:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">threshold</span><span class="o">=</span><span class="mi">0</span><span class="o">.</span><span class="mi">6</span>
<span class="n">win_length</span> <span class="o">=</span> <span class="mi">3</span>
<span class="no">MAX</span> <span class="o">=</span> <span class="mi">999999</span>
<span class="n">vals</span> <span class="o">=</span> <span class="n">c</span><span class="p">()</span>
<span class="n">idx</span> <span class="o">=</span> <span class="n">c</span><span class="p">()</span>
<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="k">in</span> <span class="mi">1</span><span class="ss">:nrow</span><span class="p">(</span><span class="n">day_wise</span><span class="p">))</span> <span class="p">{</span>
  <span class="n">val</span> <span class="o">=</span> <span class="n">day_wise</span><span class="vg">$total</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
  
  <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">&gt;</span> <span class="mi">3</span> <span class="o">&amp;&amp;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">363</span> <span class="o">&amp;&amp;</span> 
      <span class="n">any</span><span class="p">(</span> <span class="p">(</span><span class="n">val</span> <span class="o">-</span> <span class="n">day_wise</span><span class="vg">$total</span><span class="p">[(</span><span class="n">i</span><span class="o">-</span><span class="n">win_length</span><span class="p">):(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)])</span><span class="o">/</span><span class="n">day_wise</span><span class="vg">$total</span><span class="p">[(</span><span class="n">i</span><span class="o">-</span><span class="n">win_length</span><span class="p">):(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)]</span> <span class="o">&gt;</span> <span class="n">threshold</span> <span class="o">&amp;</span>
            <span class="p">(</span><span class="n">val</span> <span class="o">-</span> <span class="n">day_wise</span><span class="vg">$total</span><span class="p">[(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">):(</span><span class="n">i</span><span class="o">+</span><span class="n">win_length</span><span class="o">+</span><span class="mi">1</span><span class="p">)])</span><span class="o">/</span><span class="n">day_wise</span><span class="vg">$total</span><span class="p">[(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">):(</span><span class="n">i</span><span class="o">+</span><span class="n">win_length</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span> <span class="o">&gt;</span> <span class="n">threshold</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
    <span class="n">vals</span> <span class="o">=</span> <span class="n">c</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span><span class="n">day_wise</span><span class="vg">$date</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="n">c</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="k">class</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span> <span class="o">=</span> <span class="s2">"Date"</span>

<span class="n">fest_2015</span> <span class="o">=</span> <span class="n">c</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">19</span><span class="p">,</span><span class="mi">47</span><span class="p">,</span><span class="mi">145</span><span class="p">,</span><span class="mi">185</span><span class="p">,</span><span class="mi">250</span><span class="p">,</span><span class="mi">285</span><span class="p">,</span><span class="mi">315</span><span class="p">,</span><span class="mi">330</span><span class="p">,</span><span class="mi">359</span><span class="p">)</span>

<span class="n">g3</span> <span class="o">=</span> <span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">day_wise</span><span class="p">)</span> <span class="o">+</span> <span class="n">geom_bar</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">date</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">total</span><span class="p">),</span> <span class="n">stat</span><span class="o">=</span><span class="s2">"identity"</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="s2">"grey"</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">0</span><span class="o">.</span><span class="mi">8</span><span class="p">)</span>
<span class="n">g3</span> <span class="o">=</span> <span class="n">g3</span> <span class="o">+</span> <span class="n">geom_point</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">day_wise</span><span class="p">[</span><span class="n">fest_2015</span><span class="p">,],</span> <span class="n">aes</span><span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="n">total</span><span class="p">),</span> <span class="n">stat</span><span class="o">=</span><span class="s2">"identity"</span><span class="p">,</span> <span class="n">colour</span><span class="o">=</span><span class="s2">"red"</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mi">0</span><span class="o">.</span><span class="mi">8</span><span class="p">)</span>
<span class="n">g3</span> <span class="o">=</span> <span class="n">g3</span> <span class="o">+</span> <span class="n">geom_bar</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">day_wise</span><span class="p">[</span><span class="n">idx</span><span class="p">,],</span> <span class="n">aes</span><span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="n">total</span><span class="p">),</span> <span class="n">stat</span><span class="o">=</span><span class="s2">"identity"</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="s2">"blue"</span><span class="p">)</span>
<span class="n">g3</span> <span class="o">=</span> <span class="n">g3</span> <span class="o">+</span> <span class="n">labs</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">"Red dot holidays 2015"</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s2">"Day"</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">"No. of Complaints"</span><span class="p">)</span>
<span class="n">g3</span></code></pre></figure>

<p><img src="/images/festival_dots.png" alt="homeless_complaints" /></p>

<p>The blue peaks are some sort of a local maximum. These are the days/points in the year when within both +3 days and -3 days window we find days when the homeless complaints drop to 60% of the number of complaints that were observed on that particular day.</p>

<p>Interesting insight that a local maxima usually occurs <code class="highlighter-rouge">around</code> the holiday/festival date and generally not on that particular day.</p>

